<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Meta -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-signin-client_id" content="730014109642-7rldv9agg9qp0avagkapdv9l4kocjt5e.apps.googleusercontent.com">

    <!-- Title -->
    <title>Soup - Restaurant with Online Ordering System Template</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="/assets/img/favicon.png">
    <link rel="apple-touch-icon" href="/assets/img/favicon_60x60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicon_76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicon_120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicon_152x152.png">

    <!-- CSS Plugins -->
    <link rel="stylesheet" href="/assets/plugins/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/plugins/slick-carousel/slick/slick.css" />
    <link rel="stylesheet" href="/assets/plugins/animate.css/animate.min.css" />
    <link rel="stylesheet" href="/assets/plugins/animsition/dist/css/animsition.min.css" />
    <link rel="stylesheet" href="/assets/plugins/toastr/toastr.min.css" />

    <!-- CSS Icons -->
    <link rel="stylesheet" href="/assets/css/themify-icons.css" />
    <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css" />

    <!-- CSS Theme -->
    <link id="theme" rel="stylesheet" href="/assets/css/themes/theme-beige.css" />
    <link id="theme" rel="stylesheet" href="/assets/css/themes/my-personal.css" />


</head>

<body class="header-absolute">

<!-- Body Wrapper -->
<div id="body-wrapper" class="animsition">


    <div id="content ">
        <section class="section ">

            <div class="fullscreen-bg bg-dark dark">
                <video loop muted autoplay  class="bg-video-mine" style="opacity: 0.3">
                    <source src='/assets/videos/home.mp4'  type="video/mp4">
                </video>
            </div>

            <div class="row">
                <div class="push-md-4 col-md-4">
                    <img src='/assets/img/logo-horizontal-light.png'  class="img-fluid">
                </div>
            </div>

            <br>
            <div class="row">
                <div class="col-4 push-4">
                    <div class="card ">
                        <div class="card-block">

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="g-signin2"  data-longtitle="true" data-onsuccess="onSignIn"></div>
                                </div>
                                <div class="col-md-6">
                                    <button id="Btn_FacebookLogin" type="button" class="btn btn-secondary" onclick="facebookSignIn();">Facebook Login</button>
                                    <!--<div class="fb-login-button" data-width="" data-size="large" data-button-type="login_with" data-auto-logout-link="true" data-use-continue-as="true" data-scope="public_profile,email" data-onlogin="onFacebookLogin();"></div>-->
                                </div>
                            </div>
                            <br>
                            <center><h5 class="center">or</h5></center>


                            <form id="mainForm" method="post" action="#" >
                                <input name="post_Email" class=" form-control" type="text" id="input-email" placeholder="Email" >
                                <br>
                                <input name="post_Password" class="form-control" type="password" id="input-password" placeholder="Password">
                                <br>
                                <input type="hidden" name="_csrf" value="{{_csrfToken}}" >
                                <div class="row">
                                    <div class="col-5"></div>
                                    <div class="col-3">
                                        <a href="/signup">Sign Up</a>
                                    </div>
                                    <div class="col-4">
                                        <a href="/resetPassword">Forget Password</a>
                                    </div>
                                </div>

                                <br>

                                <div class="row">
                                    <input  class="push-4 col-md-4 btn btn-primary" type="submit" value="Sign In">
                                </div>

                                <div id="status">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!--These br tags are added so that when we click on some other page, the scroll up animation works correctly -->
            <!-- Try Removing these br tags and then go from home page to about page and you will see -->
            <br><br><br><br><br><br><br><br><br><br>

        </section>
    </div>
    {{>cart_new}}

    {{>panel_mobile}}

    <!-- Body Overlay : used to darken the rest of layout when cart is opened -->
    <div id="body-overlay"></div>

</div>


<!-- JS Plugins -->
<script src="/assets/plugins/jquery/dist/jquery.min.js"></script>
<script src="/assets/plugins/tether/dist/js/tether.min.js"></script>
<script src="/assets/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/assets/plugins/slick-carousel/slick/slick.min.js"></script>
<script src="/assets/plugins/jquery.appear/jquery.appear.js"></script>
<script src="/assets/plugins/jquery.scrollto/jquery.scrollTo.min.js"></script>
<script src="/assets/plugins/jquery.localscroll/jquery.localScroll.min.js"></script>
<script src="/assets/plugins/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="/assets/plugins/jquery.mb.ytplayer/dist/jquery.mb.YTPlayer.min.js"></script>
<script src="/assets/plugins/twitter-fetcher/js/twitterFetcher_min.js"></script>
<script src="/assets/plugins/skrollr/dist/skrollr.min.js"></script>
<script src="/assets/plugins/animsition/dist/js/animsition.min.js"></script>
<script src="/assets/plugins/toastr/toastr.min.js" ></script>

<script src="https://apis.google.com/js/platform.js" async defer></script>
<script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>
<!-- JS Core -->
<script src="/assets/js/core.js"></script>

<!-- Changes in javascript made by me-->
<script src="/assets/js/myPersonal.js"></script>
<script src="/assets/js/cart.js"></script>

<script>

    window.fbAsyncInit = function() {
        FB.init({
            appId      : '126236152092833',
            status : false,  // stops auto login
            cookie     : true,
            xfbml      : true,
            version    : 'v6.0'
        });
    };

    function googleSignOut() {
        try{
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                console.log('User signed out.');
                return true ;
            }) ;
        }catch(err) {
            console.log("Error") ;
            console.log(err) ;
            return false ;
        }
    }






    function onSignIn(googleUser) {
        console.log("signed in google") ;
        var id_token = googleUser.getAuthResponse().id_token;
        $.ajax({
            url : '/signup/google',
            method : "POST",
            data : {
              "post_idToken" : id_token,
              "_csrf" : "{{_csrfToken}}"
            },
            success : (result)=>{
                if(result.status ==true){
                  googleSignOut() ;
                  redirectBack('/')
                }
            },
            error : (err)=> {
              //TODO show error msg
                makeToast(warn, "Error in logging in") ;
                console.log("error");
                console.log(err);
            }
        }) ;

    }


  function facebookSignIn(){
    // This function is called after clicking the login button
    FB.login(function (response){
      // this inside function is called after we have gotten the result of facebook login
        // If the user gave permission, our status will be connected, else we show an error
        if (response.status === 'connected') {
            // Logged into your webpage and Facebook.
            // we need to make another request to get the email and name,
            // as faceboook only sends the id after login success
            FB.api('/me', {fields: 'id,first_name, last_name, email'}, function(profileInfo) {
                if(profileInfo.error){
                    // Error in getting profile info
                    showError(profileInfo.error, "Error in getting FB Profile Info") ;
                    FB.logout(function(response) {
                        console.log("Lgging out from FB bad") ;
                    });
                }else {
                    console.log(response.authResponse.accessToken) ;
                    console.log(profileInfo) ;
                    // sending the post request
                    $.ajax({
                        url : '/signup/facebook',
                        method : "POST",
                        data : {
                            "post_idToken" : response.authResponse.accessToken,
                            "post_Email" : profileInfo.email,
                            "post_Firstname" : profileInfo.first_name,
                            "post_Lastname" : profileInfo.last_name,
                            "post_Id" : profileInfo.id,
                            "_csrf" : "{{_csrfToken}}"
                        },
                        success : (result)=>{
                          $('#Btn_FacebookLogin').text("Logged In") ;
                            if(result.status ==true){
                                console.log(result) ;
                                //sign out the facebook user
                                console.log("calling this code ") ;
                                FB.logout(function(resp) {
                                    console.log(resp) ;
                                    console.log("Lgging out from FB good") ;
                                    redirectBack('/') ;
                                });
                            }
                        },
                        error : (err)=> {
                            showError(err, "Error in Sending Post Request") ;
                            FB.logout(function(response) {
                                console.log("Lgging out from FB bad") ;
                            });
                        }
                    }) ;
                }
            });
        } else {
            // Not logged into your webpage or we are unable to tell.
            showError(response, "Error in logging in") ;
        }
    })
  }




















</script>

</body>


</html>
