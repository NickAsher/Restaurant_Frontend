<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Meta -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-signin-client_id" content="730014109642-7rldv9agg9qp0avagkapdv9l4kocjt5e.apps.googleusercontent.com">

    <!-- Title -->
    <title>Soup - Restaurant with Online Ordering System Template</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="/assets/img/favicon.png">
    <link rel="apple-touch-icon" href="/assets/img/favicon_60x60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicon_76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicon_120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicon_152x152.png">

    <!-- CSS Plugins -->
    <link rel="stylesheet" href="/assets/plugins/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/plugins/slick-carousel/slick/slick.css" />
    <link rel="stylesheet" href="/assets/plugins/animate.css/animate.min.css" />
    <link rel="stylesheet" href="/assets/plugins/animsition/dist/css/animsition.min.css" />
    <link rel="stylesheet" href="/assets/plugins/toastr/toastr.min.css" />

    <!-- CSS Icons -->
    <link rel="stylesheet" href="/assets/css/themify-icons.css" />
    <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css" />

    <!-- CSS Theme -->
    <link id="theme" rel="stylesheet" href="/assets/css/themes/theme-beige.css" />
    <link id="theme" rel="stylesheet" href="/assets/css/themes/my-personal.css" />
    <script src="https://js.stripe.com/v3/"></script>

</head>

<body>

<!-- Body Wrapper -->
<div id="body-wrapper" class="animsition">

    {{>header_light}}

    <!-- Content -->
    <div id="content">

        <!-- Page Title -->
        <div class="page-title bg-dark dark">
            <!-- BG Image -->
            <div class="bg-image bg-parallax"><img src="/assets/img/photos/bg-croissant.jpg" alt=""></div>
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 push-lg-4">
                        <h1 class="mb-0">Checkout</h1>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section -->
        <section class="section bg-light">

            <div class="container">
                <div class="row">
                    <div class="col-xl-4 push-xl-8 col-lg-5 push-lg-7">
                        <div class="shadow bg-white stick-to-content mb-4">
                            <div class="bg-dark dark p-4"><h5 class="mb-0">You order</h5></div>


                            <table id="cartTable" class="table-cart">

                            </table>
                            <div class="cart-summary">
                                <div class="row">
                                    <div class="col-7 text-right text-muted">Order total:</div>
                                    <div class="col-5">
                                        <strong>
                                            <span id="totalItemsPrice_BeforeExtraCharges" class="money-currency">Price_Here</span>
                                        </strong>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-7 text-right text-muted">Delivery:</div>
                                    <div class="col-5">
                                        <strong>
                                            <span id="totalTax"  data-tax-percentage="18" class="money-currency"></span>
                                        </strong>
                                    </div>
                                </div>
                                <hr class="hr-sm">
                                <div class="row text-md">
                                    <div class="col-7 text-right text-muted">Total:</div>
                                    <div class="col-5">
                                        <strong>
                                            <span id="totalItemsPrice_AfterExtraCharges" class="money-currency money-currency">price_here</span>
                                        </strong>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>



                    <div class="col-xl-8 pull-xl-4 col-lg-7 pull-lg-5">
                        <div class="bg-white p-4 p-md-5 mb-4">
                            <h4 class="border-bottom pb-4"><i class="ti ti-user mr-3 text-primary"></i>Basic information</h4>
                            <div class="row mb-5">
                                <div class="form-group col-sm-6">
                                    <label>Firstname:</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label>Lastname:</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label>Phone number:</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label>E-mail address:</label>
                                    <input type="email" class="form-control">
                                </div>
                            </div>

                            <h4 class="border-bottom pb-4"><i class="ti ti-package mr-3 text-primary"></i>Delivery</h4>
                            <div class="row mb-5">
                                <div class="form-group col-sm-12">
                                    <label>House/Flat/Block No</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label>Landmark</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="form-group col-sm-6">
                                    <label>City</label>
                                    <input type="text" class="form-control" value="Delhi-NCR" disabled>
                                </div>
                            </div>


                            <h4 class="border-bottom pb-4"><i class="ti ti-wallet mr-3 text-primary"></i>Payment</h4>
                            <div class="row">
                                <div class="form-group col-sm-6">
                                    <label>Card Number</label>
                                    <div id="card-element-number" class="field form-control"></div>
                                </div>
                                <div class="form-group col-sm-3">
                                    <label>Expiry Date</label>
                                    <div id="card-element-expiry" class="field form-control"></div>
                                </div>

                                <div class="form-group col-sm-3">
                                    <label>CVC</label>
                                    <div id="card-element-cvc" class="field form-control"></div>
                                </div>
                            </div>
                            <div id="card-errors-number" role="alert" class="text-center" style="color: red;"><br></div>
                            <div id="card-errors-expiry" role="alert" class="text-center" style="color: red;"><br></div>

                            <!--<button id="submit" type="button" class="btn btn-outline-primary col-8 push-2  col-md-4 push-md-4">Pay</button>-->

                        </div>
                        <div class="text-center">
                            <button id="mySuperBtn" class="btn btn-primary btn-lg"><span>Order now!</span></button>
                        </div>
                    </div>
                </div>
            </div>

        </section>


        {{>footer_new}}

    </div>
    <!-- Content / End -->

    {{>cart_new}}

    {{>panel_mobile}}

    <!-- Body Overlay -->
    <div id="body-overlay"></div>

</div>


<!-- JS Plugins -->
<script src="/assets/plugins/jquery/dist/jquery.min.js"></script>
<script src="/assets/plugins/tether/dist/js/tether.min.js"></script>
<script src="/assets/plugins/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/assets/plugins/slick-carousel/slick/slick.min.js"></script>
<script src="/assets/plugins/jquery.appear/jquery.appear.js"></script>
<script src="/assets/plugins/jquery.scrollto/jquery.scrollTo.min.js"></script>
<script src="/assets/plugins/jquery.localscroll/jquery.localScroll.min.js"></script>
<script src="/assets/plugins/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="/assets/plugins/jquery.mb.ytplayer/dist/jquery.mb.YTPlayer.min.js"></script>
<script src="/assets/plugins/twitter-fetcher/js/twitterFetcher_min.js"></script>
<script src="/assets/plugins/skrollr/dist/skrollr.min.js"></script>
<script src="/assets/plugins/animsition/dist/js/animsition.min.js"></script>
<script src="/assets/plugins/toastr/toastr.min.js" ></script>
<!-- JS Core -->
<script src="/assets/js/core.js"></script>


<!-- Changes in javascript made by me-->
<script src="/assets/js/myPersonal.js"></script>
<!--<script src="/assets/js/cart.js"></script>-->

<script >


    const stripe = Stripe('pk_test_FPbfGF5aEyQqsBfsPytI46qw002ouxr0PP');
    var elements = stripe.elements();


    function setupStripeCardElements() {
        /* This function sets up the card divs and their validation using stripe libraary
        */

        let cardNumberElement = elements.create('cardNumber', {
            placeholder: '16 Digit number here',
        });
        cardNumberElement.mount('#card-element-number');

        let cardExpiryElement = elements.create('cardExpiry', {
            placeholder: 'MM/YY',
        });
        cardExpiryElement.mount('#card-element-expiry');

        let cardCvcElement = elements.create('cardCvc', {
            placeholder: 'CVC',
        });
        cardCvcElement.mount('#card-element-cvc');

        // setting errors to show
        cardNumberElement.on('change', (result)=>{
          if(result.error){
              $('#card-errors-number').text(result.error.message) ;
          }else{
              $('#card-errors-number').html('<br>') ; //removes the error when text is changed
          }
        }) ;

        cardExpiryElement.on('change', (result)=>{
            if(result.error){
                $('#card-errors-expiry').text(result.error.message) ;
            }else{
                $('#card-errors-expiry').html('<br>') ; //removes the error when text is changed
            }
        }) ;


    }
    setupStripeCardElements() ;

    function getParsedCartItem(cartItem) {
      /* This function parses a single cart item from an object
       * like { id, name , size:{sizeId, sizePrice}, addonitems : {....} }
       * to   name, price, descriptionString
      */
        try{
            let sizeId = cartItem.itemSizeData.id ;
            let descriptionString = `Size : ${cartItem.itemSizeData.name} <br> ` ;

            cartItem.addonData.forEach((addonGroupData)=>{
                descriptionString += `${addonGroupData.addonGroupName} : ` ;
                addonGroupData.addon_items_array.forEach((addonItem)=>{
                    descriptionString += `${addonItem.name}, ` ;
                }) ;
                descriptionString = descriptionString.slice(0, -2);
                descriptionString += " <br> " ;
            }) ;
            descriptionString = descriptionString.slice(0, -5);

            return {
                name : cartItem.itemName,
                itemPrice : cartItem.itemPrice,
                descriptionString
            } ;

        }catch (e) {
            return {
                name : "error",
                descriptionString : e,
            } ;
        }
    }



    let renderCart = ()=>{
      /* This functions get data from local_storage and renders the html cart table
       *
       */
        let cartItems = JSON.parse(localStorage.getItem('cart')) ;
        $('#cartTable').html("") ;
        cartItems.forEach(function(element, index){
            let parsedElement = getParsedCartItem(element, index) ;


            $('#cartTable').append(`

            <tr>
                <td class="title">
                    <span class="name"><a href="#productModal" data-toggle="modal">${parsedElement.name}</a></span>
                    <span class="caption text-muted">${parsedElement.descriptionString}</span>
                </td>
                <td class="price"><span class="money-currency">${parsedElement.itemPrice}</span> </td>
                <td class="actions">
                    <i data-index="${index}" class="cartItemDelete ti ti-trash" style="color: darkred; cursor: pointer"></i>
                </td>
            </tr>

          `) ;
        }) ;

        let totalItemsPrice_BeforeExtraCharges = parseFloat(localStorage.getItem('total_items_price')) ;
        $('#totalItemsPrice_BeforeExtraCharges').addClass('money-currency') ;
        $('#totalItemsPrice_BeforeExtraCharges').html(totalItemsPrice_BeforeExtraCharges) ;

        let taxPercentage = $('#totalTax').attr('data-tax-percentage') ;
        let taxMonetaryValue = totalItemsPrice_BeforeExtraCharges * (parseFloat(taxPercentage)/100) ;
        $('#totalTax').html(taxMonetaryValue) ;
        $('#totalTax').addClass('money-currency') ;

        let totalItemsPrice_AfterExtraCharges = totalItemsPrice_BeforeExtraCharges + taxMonetaryValue ;
        $('#totalItemsPrice_AfterExtraCharges').html(totalItemsPrice_AfterExtraCharges) ;
        $('#totalItemsPrice_AfterExtraCharges').addClass('money-currency') ;


        formatCurrency() ;
    } ;

    renderCart() ;




    $(".cartItemDelete").click(function (){
        // this function deletes the cart item from the local storage
        let itemIndex = $(this).attr('data-index') ;
        let cartItems = JSON.parse(localStorage.getItem('cart')) ;
        let removedItem = cartItems.splice(itemIndex, 1) ; // splice(positiontoRemoveAt, noOfItemsToRemove)   returns an array of removed objects
        localStorage.setItem('cart', JSON.stringify(cartItems)) ;
        localStorage.setItem('total_items', parseInt(localStorage.total_items) -1) ;
        localStorage.setItem('total_items_price', "" + (parseFloat(localStorage.getItem('total_items_price')) - parseFloat(removedItem[0].itemPrice)) ) ;

        $('#totalCartItems').html(localStorage.total_items) ;
        renderCart() ;
        // $('#Button_OpenCart').trigger('click') ; // this is to close the cart dialog
        makeToast('info', "Item removed from cart") ;
    }) ;








</script>

</body>


</html>
